<!DOCTYPE html>
<html lang="en">
<head>
 <meta charset="UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <title>Rent Inspect System</title>
 

  <link rel="stylesheet" href="style.css">
  <script src="app.js" defer></script>
</head>
<body>
 <div class="container">
 <div class="header">
 <div class="header-top">
 <div class="header-info-table" id="headerInfoTable">
 <table class="property-info-table">
 <tr>
 <td class="info-label">Property:</td>
 <td class="info-value" id="headerProperty">-</td>
 <td class="info-label">Unit:</td>
 <td class="info-value" id="headerUnit">-</td>
 </tr>
 <tr>
 <td class="info-label">Address:</td>
 <td class="info-value" id="headerAddress" colspan="3">-</td>
 </tr>
 <tr>
 <td class="info-label">Inspector:</td>
 <td class="info-value" id="headerInspector">-</td>
 <td class="info-label">Date:</td>
 <td class="info-value" id="headerDate">-</td>
 </tr>
 <tr>
 <td class="info-label">Email:</td>
 <td class="info-value" id="headerEmail">-</td>
 <td class="info-label">Notice Served:</td>
 <td class="info-value" id="headerNoticeDate">-</td>
 </tr>
 </table>
 </div>
 <div class="header-right">
 <img id="headerLogo" class="header-logo" src="" alt="" style="display: none;">
 <h1 class="header-title"> Rent Inspect System</h1>
 </div>
 </div>
 <div class="branding-footer no-print" style="font-size: 22px;">
 <span id="companyNameDisplay" style="display: none;"></span><span id="brandingText" contenteditable="true">Bi-Annual Unit Inspection</span> - INSPECTION REPORT
 </div>
 </div>

 <!-- Go to Bottom Button (at top of page) -->
 <button class="go-to-bottom-btn no-print" onclick="window.scrollTo(0, document.body.scrollHeight)" title="Go to Bottom">&darr;</button>

 <div class="content">
 <!-- Settings Panel -->
 <div class="settings-panel no-print" id="settingsPanel" data-show-on-step="1">
 <div class="settings-title"> Customize Report</div>
 <div class="form-group" style="margin-bottom: 20px;">
 <label style="font-weight: 600; color: var(--secondary-color); display: block; margin-bottom: 8px;">Company Name</label>
 <input type="text" id="companyName" placeholder="Enter company name" style="width: 100%; padding: 10px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 14px;" oninput="updateCompanyName()">
 </div>
 <div class="color-picker-group">
 <div class="color-picker-item">
 <label>Primary Color</label>
 <input type="color" id="primaryColor" value="#f97316" onchange="updateColors()">
 </div>
 <div class="color-picker-item">
 <label>Secondary Color</label>
 <input type="color" id="secondaryColor" value="#6b7280" onchange="updateColors()">
 </div>
 <div class="color-picker-item">
 <label>Dark Color</label>
 <input type="color" id="darkColor" value="#1f2937" onchange="updateColors()">
 </div>
 </div>
 <div>
 <label style="font-weight: 600; color: var(--secondary-color); display: block; margin-bottom: 8px;">Company Logo</label>
 <input type="file" id="logoUpload" accept="image/*" onchange="handleLogoUpload(this)" style="margin-bottom: 10px;">
 <label style="display: flex; align-items: center; gap: 8px; font-size: 14px; color: var(--secondary-color); cursor: pointer;">
 <input type="checkbox" id="logoLockToggle" onchange="toggleLogoLock()" style="width: 18px; height: 18px; cursor: pointer;">
 Lock logo for this device
 </label>
 </div>
 </div>

 <!-- Step Indicator -->
 <div class="step-indicator no-print">
 <div class="step active"><div class="step-circle">1</div><div class="step-label">Property</div></div>
 <div class="step"><div class="step-circle">2</div><div class="step-label">Layout</div></div>
 <div class="step"><div class="step-circle">3</div><div class="step-label">Safety</div></div>
 <div class="step"><div class="step-circle">4</div><div class="step-label">Appliances</div></div>
 <div class="step"><div class="step-circle">5</div><div class="step-label">Rooms</div></div>
 <div class="step"><div class="step-circle">6</div><div class="step-label">Report</div></div>
 </div>

 <!-- STEP 1: Property Information -->
 <div class="form-section active" data-section="1">
 <h2 class="section-title"> Property Information</h2>
 <p class="section-subtitle">Enter property details for this inspection.</p>

 <div class="form-grid">
 <div class="form-group">
 <label>Property Name <span class="required">*</span></label>
 <select id="propertyNameSelect" onchange="handlePropertyChange()" required>
 <option value="">Select Property</option>
 <option value="Park Village 1 & 2">Park Village 1 & 2</option>
 <option value="Huntington Court 1 & 2">Huntington Court 1 & 2</option>
 <option value="Windsor Park">Windsor Park</option>
 <option value="Hampton Court">Hampton Court</option>
 <option value="Spurling Court">Spurling Court</option>
 <option value="Berg Rose">Berg Rose</option>
 <option value="Cashmere Park">Cashmere Park</option>
 <option value="Pennsylvania Place">Pennsylvania Place</option>
 <option value="Westview Villa">Westview Villa</option>
 <option value="Chestnut Grove">Chestnut Grove</option>
 <option value="Vineyard Apartments">Vineyard Apartments</option>
 <option value="Vineyard 2 Apartments">Vineyard 2 Apartments</option>
 <option value="Edison Park">Edison Park</option>
 <option value="Paragon Apartments">Paragon Apartments</option>
 <option value="Valley Commons 1 Apartments">Valley Commons 1 Apartments</option>
 <option value="Valley Commons 2 Apartments">Valley Commons 2 Apartments</option>
 <option value="CUSTOM">Enter Custom</option>
 </select>
 <input type="text" id="propertyNameCustom" class="hidden" placeholder="Enter custom property name" oninput="updateHeaderInfo()">
 </div>

 <div class="form-group">
 <label>Unit Number <span class="required">*</span></label>
 <input type="text" id="unitNumber" required oninput="updateHeaderInfo()">
 </div>

 <div class="form-group">
 <label>Property Address <span class="required">*</span></label>
 <select id="propertyAddressSelect" onchange="handleAddressChange()" required>
 <option value="">Select Address</option>
 </select>
 <input type="text" id="propertyAddressCustom" class="hidden" placeholder="Enter address" oninput="updateHeaderInfo()">
 </div>

 <div class="form-group">
 <label>City, State, ZIP <span class="required">*</span></label>
 <input type="text" id="cityStateZip" required readonly style="background: #f9fafb;">
 <input type="text" id="cityStateZipCustom" class="hidden" placeholder="Enter city, state, ZIP" oninput="updateHeaderInfo()">
 </div>

 <div class="form-group">
 <label>Inspector Name <span class="required">*</span></label>
 <select id="inspectorNameSelect" onchange="handleInspectorChange()" required>
 <option value="">Select Inspector</option>
 </select>
 <input type="text" id="inspectorNameCustom" class="hidden" placeholder="Enter inspector name" oninput="updateHeaderInfo()">
 </div>

 <div class="form-group">
 <label>Inspector Email</label>
 <input type="email" id="inspectorEmail" readonly style="background: #f9fafb;">
 <input type="email" id="inspectorEmailCustom" class="hidden" placeholder="Enter email" oninput="updateHeaderInfo()">
 </div>

 <div class="form-group">
 <label>Inspection Date <span class="required">*</span></label>
 <input type="date" id="inspectionDate" required onchange="updateHeaderInfo()">
 </div>

 <div class="form-group">
 <label>Inspection Notice Served Date <span class="required">*</span></label>
 <input type="date" id="noticeServedDate" required onchange="updateHeaderInfo()">
 </div>

 <div class="form-group">
 <label>Inspection Type</label>
 <select id="inspectionType" onchange="updateHeaderInfo()">
 <option value="Bi-Annual Unit Inspection">Bi-Annual Unit Inspection</option>
 <option value="Move-In Inspection">Move-In Inspection</option>
 <option value="Move-Out Inspection">Move-Out Inspection</option>
 <option value="Annual Inspection">Annual Inspection</option>
 <option value="Quarterly Inspection">Quarterly Inspection</option>
 <option value="Maintenance Inspection">Maintenance Inspection</option>
 <option value="Pre-Lease Inspection">Pre-Lease Inspection</option>
 </select>
 </div>
 </div>

 <div class="btn-group">
 <button class="btn btn-secondary" onclick="loadProgressFromLocalStorage()">Load Saved</button>
 <button class="btn btn-secondary" onclick="saveProgressToLocalStorage()">Save Progress</button>
 <button class="btn btn-primary" onclick="nextStep()">Next Step &rarr;</button>
 </div>
 </div>

 <!-- STEP 2: Unit Layout -->
 <div class="form-section" data-section="2">
 <h2 class="section-title"> Unit Layout</h2>
 <p class="section-subtitle">Configure which rooms and how many appliances to inspect.</p>

 <div class="form-grid">
 <div class="form-group">
 <label>Entry?</label>
 <select id="hasEntry">
 <option value="yes">Yes</option>
 <option value="no">No</option>
 </select>
 </div>

 <div class="form-group">
 <label>Kitchen?</label>
 <select id="hasKitchen">
 <option value="yes">Yes</option>
 <option value="no">No</option>
 </select>
 </div>

 <div class="form-group">
 <label>Dining Room?</label>
 <select id="hasDiningRoom">
 <option value="yes">Yes</option>
 <option value="no">No</option>
 </select>
 </div>

 <div class="form-group">
 <label>Living Room?</label>
 <select id="hasLivingRoom">
 <option value="yes">Yes</option>
 <option value="no">No</option>
 </select>
 </div>

 <div class="form-group">
 <label>Number of Bedrooms</label>
 <input type="number" id="numBedrooms" min="0" max="10" value="2">
 </div>

 <div class="form-group">
 <label>Number of Bathrooms</label>
 <input type="number" id="numBathrooms" min="0" max="10" value="1">
 </div>

 <div class="form-group">
 <label>Laundry Room?</label>
 <select id="hasLaundryRoom">
 <option value="yes">Yes</option>
 <option value="no">No</option>
 </select>
 </div>

 <div class="form-group">
 <label>Number of Hallways/Stairways</label>
 <input type="number" id="numHallways" min="0" max="5" value="0">
 </div>

 <div class="form-group">
 <label>Number of Smoke Alarms <span class="required">*</span></label>
 <input type="number" id="numSmokeAlarms" min="0" max="20" value="0">
 <small style="color: #64748b; font-size: 12px;">Total smoke/CO alarms in entire unit</small>
 </div>

 <div class="form-group">
 <label>Outside Deck/Patio?</label>
 <select id="hasOutsideDeck">
 <option value="yes">Yes</option>
 <option value="no">No</option>
 </select>
 </div>

 <div class="form-group">
 <label>Number of Appliances <span class="required">*</span></label>
 <input type="number" id="numAppliances" min="0" max="20" value="0">
 <small style="color: #64748b; font-size: 12px;">Total appliances in entire unit</small>
 </div>
 </div>

 <div class="btn-group">
 <button class="btn btn-secondary" onclick="previousStep()"> &larr; Previous</button>
 <button class="btn btn-primary" onclick="nextStep()">Next Step &rarr;</button>
 </div>
 </div>

 <!-- STEP 3: General Safety -->
 <div class="form-section" data-section="3">
 <h2 class="section-title"> General Safety</h2>
 <p class="section-subtitle">Document smoke alarms and safety observations.</p>

 <div class="inspection-item">
 <div class="form-group">
 <label class="checkbox-label">
 <input type="checkbox" id="petsIndicated" onchange="togglePetsComments()">
 Pets Indicated
 </label>
 </div>
 <textarea class="comment-field hidden" id="petsComments" placeholder="Enter details about pets (type, number, etc.)..." style="width: 100%; padding: 10px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 14px; margin-top: 10px;"></textarea>
 </div>

 <div class="inspection-item">
 <div class="form-group">
 <label class="checkbox-label">
 <input type="checkbox" id="pestInfestation" onchange="togglePestComments()">
 Bug/Pest Infestation
 </label>
 </div>
 <textarea class="comment-field hidden" id="pestComments" placeholder="Enter details about pest infestation (type, location, severity, etc.)..." style="width: 100%; padding: 10px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 14px; margin-top: 10px;"></textarea>
 </div>

 <div id="smokeAlarmsContainer"></div>

 <div class="subsection-title">Safety Photos</div>
 <div id="safetyPhotoButtons"></div>
 <div id="safetyPhotoPreview" class="photo-preview"></div>

 <div class="btn-group">
 <button class="btn btn-secondary" onclick="previousStep()"> &larr; Previous</button>
 <button class="btn btn-primary" onclick="nextStep()">Next Step &rarr;</button>
 </div>
 </div>

 <!-- STEP 4: Appliances -->
 <div class="form-section" data-section="4">
 <h2 class="section-title"> Appliance Inspection</h2>
 <p class="section-subtitle">Document all appliances in the unit.</p>

 <div id="appliancesContainer"></div>

 <div class="subsection-title">Appliance Photos</div>
 <div id="appliancePhotoButtons"></div>
 <div id="appliancePhotoPreview" class="photo-preview"></div>

 <div class="btn-group">
 <button class="btn btn-secondary" onclick="previousStep()"> &larr; Previous</button>
 <button class="btn btn-primary" onclick="nextStep()">Next Step &rarr;</button>
 </div>
 </div>

 <!-- STEP 5: Room Inspection -->
 <div class="form-section" data-section="5">
 <h2 class="section-title"> Room-by-Room Inspection</h2>
 <p class="section-subtitle">Inspect each room systematically.</p>

 <div class="room-indicator" id="roomIndicator">Room 1 of X</div>
 <div id="roomInspectionContainer"></div>

 <div class="subsection-title">Room Photos</div>
 <div id="roomPhotoButtons"></div>
 <div id="roomPhotoPreview" class="photo-preview"></div>

 <div class="btn-group">
 <button class="btn btn-secondary" onclick="previousRoom()"> Previous Room</button>
 <button class="btn btn-primary" onclick="nextRoom()">Next Room &rarr;</button>
 </div>
 </div>

 <!-- STEP 6: Report -->
 <div class="form-section" data-section="6">
 <h2 class="section-title"> Inspection Report</h2>
 
 <div class="btn-group no-print" style="margin-bottom: 30px;">
 <button class="btn btn-success" onclick="generateReport()"> Generate Report</button>
 <button class="btn btn-primary" onclick="printReport()"> Print Report</button>
 <button class="btn btn-secondary" onclick="emailReport()"> Email Report</button>
 <button class="btn" style="background: #10b981; color: white;" onclick="startNewInspection()"> Start New Inspection</button>
 </div>

 <div id="reportContent"></div>

 <div class="btn-group no-print">
 <button class="btn btn-secondary" onclick="previousStep()"> Back to Edit</button>
 </div>
 </div>
 </div>
 </div>

 <script>
 // Global state
 let currentStep = 1;
 let currentRoomIndex = 0;
 let rooms = [];
 let appliances = [];
 let smokeAlarms = [];
 let allPhotos = {};
 let uploadedLogo = null;
 let brandingText = 'Multi-Family Housing Inspection Services';
 let lockedLogo = null;
 let logoLocked = false;
 let companyName = '';
 
 // Refresh protection
 let hasUnsavedChanges = false;
 
 window.addEventListener('beforeunload', function(e) {
 if (hasUnsavedChanges) {
 e.preventDefault();
 e.returnValue = '';
 
 // Auto-save on refresh attempt
 saveProgressToLocalStorage();
 
 return 'You have unsaved changes. Do you want to save your progress before leaving?';
 }
 });
 
 // Detect accidental refresh gestures
 let touchStartY = 0;
 document.addEventListener('touchstart', function(e) {
 touchStartY = e.touches[0].clientY;
 });
 
 document.addEventListener('touchmove', function(e) {
 const touchY = e.touches[0].clientY;
 const touchDiff = touchY - touchStartY;
 
 // Detect pull-to-refresh gesture
 if (touchDiff > 50 && window.scrollY === 0) {
 e.preventDefault();
 if (confirm('Are you sure you want to refresh? All unsaved progress will be lost.\n\nYour current progress will be automatically saved. You can load it using the "Load Saved" button on the Property Information page.')) {
 saveProgressToLocalStorage();
 location.reload();
 }
 }
 }, { passive: false });

 // Property database
 const propertyDatabase = {
 "Park Village 1 & 2": {
 addresses: ["502 South 5th Street", "554 South 5th Street"],
 cityStateZip: "Selah, WA 98942",
 inspectors: ["Ellie McNelley", "Julian Rubio"],
 email: "parkvillage@quantumres.com"
 },
 "Huntington Court 1 & 2": {
 addresses: ["306 East Manitoba Avenue"],
 cityStateZip: "Ellensburg, WA 98926",
 inspectors: ["Kellen Sims", "Daniel Gottshalk"],
 email: "huntingtoncourt@quantumres.com"
 },
 "Windsor Park": {
 addresses: ["401 East Cherry Lane"],
 cityStateZip: "Ellensburg, WA 98926",
 inspectors: ["Kellen Sims", "Daniel Gottshalk"],
 email: "windsorpark@quantumres.com"
 },
 "Hampton Court": {
 addresses: ["700 North Cle Elum Street"],
 cityStateZip: "Ellensburg, WA 98926",
 inspectors: ["Charity Butler", "Jeremy Kingcade"],
 email: "hamptoncourt@quantumre.com"
 },
 "Spurling Court": {
 addresses: ["1204 Rainier Steet"],
 cityStateZip: "Ellensburg, WA 98926",
 inspectors: ["Charity Butler", "Jeremy Kingcade"],
 email: "spurlingcourt@quantumres.com"
 },
 "Berg Rose": {
 addresses: ["1263 Mine Street"],
 cityStateZip: "Leavenworth, WA 98826",
 inspectors: ["Aneisha Crane", "Melvin Graham"],
 email: "bergrose@quantumres.com"
 },
 "Cashmere Park": {
 addresses: ["302 Fisher Street"],
 cityStateZip: "Cashmere, WA 98815",
 inspectors: ["Aneisha Crane", "Melvin Graham"],
 email: "cashmerepark@quantumres.com"
 },
 "Pennsylvania Place": {
 addresses: ["103 E Pennsylvania Avenue"],
 cityStateZip: "Roslyn, WA 98941",
 inspectors: ["Shenna Redding", "Randy Raney"],
 email: "pennsylvaniaplace@quantumres.com"
 },
 "Westview Villa": {
 addresses: ["400 Denny Avenue"],
 cityStateZip: "Cle Elum, WA 98922",
 inspectors: ["Shenna Redding", "Randy Raney"],
 email: "westviewvilla@quantumres.com"
 },
 "Chestnut Grove": {
 addresses: ["610 S Chestnut Street"],
 cityStateZip: "Moses Lake, WA 98837",
 inspectors: ["Christine Buley", "Jose Tinoco"],
 email: "chestnutgrove@quantumres.com"
 },
 "Vineyard Apartments": {
 addresses: ["405 Nicka Road"],
 cityStateZip: "Grandview, WA 98930",
 inspectors: ["Yesenia Ramos", "Ryan Davis"],
 email: "vineyard@quantumres.com"
 },
 "Vineyard 2 Apartments": {
 addresses: ["810 Grandridge Road"],
 cityStateZip: "Grandview, WA 98930",
 inspectors: ["Yesenia Ramos", "Ryan Davis"],
 email: "vineyard@quantumres.com"
 },
 "Edison Park": {
 addresses: ["2400 E Edison Avenue"],
 cityStateZip: "Sunnyside WA 98944",
 inspectors: ["Halondra Arambula", "Marin Sandova", "Joel Moreno"],
 email: "paisleymgr@quantumres.com"
 },
 "Paragon Apartments": {
 addresses: ["1320 S. 11th St."],
 cityStateZip: "Sunnyside WA 98944",
 inspectors: ["Halondra Arambula", "Marin Sandova", "Joel Moreno"],
 email: "paisleymgr@quantumres.com"
 },
 "Valley Commons 1 Apartments": {
 addresses: ["725 McClain Drive"],
 cityStateZip: "Sunnyside WA 98944",
 inspectors: ["Halondra Arambula", "Marin Sandova", "Joel Moreno"],
 email: "paisleymgr@quantumres.com"
 },
 "Valley Commons 2 Apartments": {
 addresses: ["700 McClain Drive"],
 cityStateZip: "Sunnyside WA 98944",
 inspectors: ["Halondra Arambula", "Marin Sandova", "Joel Moreno"],
 email: "paisleymgr@quantumres.com"
 }
 };

 // Save/Load functionality
 function saveProgressToLocalStorage() {
 const progressData = {
 currentStep,
 currentRoomIndex,
 rooms,
 appliances,
 smokeAlarms,
 allPhotos,
 uploadedLogo,
 brandingText,
 companyName,
 propertyInfo: {
 propertyNameSelect: document.getElementById('propertyNameSelect').value,
 propertyNameCustom: document.getElementById('propertyNameCustom').value,
 unitNumber: document.getElementById('unitNumber').value,
 propertyAddressSelect: document.getElementById('propertyAddressSelect').value,
 propertyAddressCustom: document.getElementById('propertyAddressCustom').value,
 cityStateZip: document.getElementById('cityStateZip').value,
 cityStateZipCustom: document.getElementById('cityStateZipCustom').value,
 inspectorNameSelect: document.getElementById('inspectorNameSelect').value,
 inspectorNameCustom: document.getElementById('inspectorNameCustom').value,
 inspectorEmail: document.getElementById('inspectorEmail').value,
 inspectorEmailCustom: document.getElementById('inspectorEmailCustom').value,
 inspectionDate: document.getElementById('inspectionDate').value,
 noticeServedDate: document.getElementById('noticeServedDate').value,
 inspectionType: document.getElementById('inspectionType').value
 },
 colors: {
 primary: document.getElementById('primaryColor').value,
 secondary: document.getElementById('secondaryColor').value,
 dark: document.getElementById('darkColor').value
 }
 };
 
 localStorage.setItem('inspectionProgress', JSON.stringify(progressData));
 hasUnsavedChanges = false;
 alert('Progress saved successfully!');
 }
 
 function loadProgressFromLocalStorage() {
 const saved = localStorage.getItem('inspectionProgress');
 if (!saved) {
 alert('No saved progress found.');
 return;
 }
 
 if (!confirm('Load saved progress? This will replace your current data.')) {
 return;
 }
 
 const progressData = JSON.parse(saved);
 
 // Restore global state
 currentStep = progressData.currentStep || 1;
 currentRoomIndex = progressData.currentRoomIndex || 0;
 rooms = progressData.rooms || [];
 appliances = progressData.appliances || [];
 smokeAlarms = progressData.smokeAlarms || [];
 allPhotos = progressData.allPhotos || {};
 uploadedLogo = progressData.uploadedLogo || null;
 brandingText = progressData.brandingText || 'Multi-Family Housing Inspection Services';
 companyName = progressData.companyName || '';
 
 // Restore property info
 if (progressData.propertyInfo) {
 const pi = progressData.propertyInfo;
 document.getElementById('propertyNameSelect').value = pi.propertyNameSelect || '';
 document.getElementById('propertyNameCustom').value = pi.propertyNameCustom || '';
 document.getElementById('unitNumber').value = pi.unitNumber || '';
 document.getElementById('propertyAddressSelect').value = pi.propertyAddressSelect || '';
 document.getElementById('propertyAddressCustom').value = pi.propertyAddressCustom || '';
 document.getElementById('cityStateZip').value = pi.cityStateZip || '';
 document.getElementById('cityStateZipCustom').value = pi.cityStateZipCustom || '';
 document.getElementById('inspectorNameSelect').value = pi.inspectorNameSelect || '';
 document.getElementById('inspectorNameCustom').value = pi.inspectorNameCustom || '';
 document.getElementById('inspectorEmail').value = pi.inspectorEmail || '';
 document.getElementById('inspectorEmailCustom').value = pi.inspectorEmailCustom || '';
 document.getElementById('inspectionDate').value = pi.inspectionDate || '';
 document.getElementById('noticeServedDate').value = pi.noticeServedDate || '';
 document.getElementById('inspectionType').value = pi.inspectionType || 'Bi-Annual Unit Inspection';
 
 // Trigger property change to populate dropdowns
 if (pi.propertyNameSelect) {
 handlePropertyChange();
 }
 }
 
 // Restore colors
 if (progressData.colors) {
 document.getElementById('primaryColor').value = progressData.colors.primary;
 document.getElementById('secondaryColor').value = progressData.colors.secondary;
 document.getElementById('darkColor').value = progressData.colors.dark;
 updateColors();
 }
 
 // Restore logo
 if (uploadedLogo) {
 const headerLogo = document.getElementById('headerLogo');
 headerLogo.src = uploadedLogo;
 headerLogo.style.display = 'block';
 }
 
 // Restore company name
 if (companyName && document.getElementById('companyName')) {
 document.getElementById('companyName').value = companyName;
 }
 
 updateHeaderInfo();
 updateDisplay();
 hasUnsavedChanges = false;
 
 alert('Progress loaded successfully!');
 }

 // Initialize
 window.onload = function() {
 document.getElementById('inspectionDate').valueAsDate = new Date();
 updateHeaderInfo();
 
 // Load locked logo if exists
 const savedLogoLocked = localStorage.getItem('logoLocked');
 const savedLogo = localStorage.getItem('lockedLogo');
 
 if (savedLogoLocked === 'true' && savedLogo) {
 logoLocked = true;
 uploadedLogo = savedLogo;
 document.getElementById('logoLockToggle').checked = true;
 const headerLogo = document.getElementById('headerLogo');
 headerLogo.src = savedLogo;
 headerLogo.style.display = 'block';
 }
 };

 // Color customization
 function updateColors() {
 const primary = document.getElementById('primaryColor').value;
 const secondary = document.getElementById('secondaryColor').value;
 const dark = document.getElementById('darkColor').value;
 
 document.documentElement.style.setProperty('--primary-color', primary);
 document.documentElement.style.setProperty('--secondary-color', secondary);
 document.documentElement.style.setProperty('--dark-color', dark);
 }

 // Logo upload
 function handleLogoUpload(input) {
 if (input.files && input.files[0]) {
 const reader = new FileReader();
 reader.onload = function(e) {
 uploadedLogo = e.target.result;
 const headerLogo = document.getElementById('headerLogo');
 headerLogo.src = uploadedLogo;
 headerLogo.style.display = 'block';
 
 // If logo is locked, save it
 if (logoLocked) {
 localStorage.setItem('lockedLogo', uploadedLogo);
 }
 };
 reader.readAsDataURL(input.files[0]);
 }
 }
 
 // Logo lock toggle
 function toggleLogoLock() {
 logoLocked = document.getElementById('logoLockToggle').checked;
 
 if (logoLocked && uploadedLogo) {
 localStorage.setItem('lockedLogo', uploadedLogo);
 localStorage.setItem('logoLocked', 'true');
 alert('Logo locked for this device!');
 } else {
 localStorage.removeItem('lockedLogo');
 localStorage.removeItem('logoLocked');
 if (!logoLocked) {
 alert('Logo unlocked!');
 }
 }
 }
 
 // Company name update
 function updateCompanyName() {
 companyName = document.getElementById('companyName').value;
 const display = document.getElementById('companyNameDisplay');
 if (companyName) {
 display.textContent = companyName + ' - ';
 display.style.display = 'inline';
 } else {
 display.style.display = 'none';
 }
 hasUnsavedChanges = true;
 }
 
 // Toggle pets comments field
 function togglePetsComments() {
 const checkbox = document.getElementById('petsIndicated');
 const comments = document.getElementById('petsComments');
 if (checkbox.checked) {
 comments.classList.remove('hidden');
 } else {
 comments.classList.add('hidde